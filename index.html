<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stacja Pogodowa ESP32</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js"></script>
</head>
<body>
    <h1>Aktualne dane z czujników</h1>
    
    <div>
        <h2>Temperatura</h2>
        <p id="temp">Ładowanie...</p>
    </div>
    <div>
        <h2>Wilgotność</h2>
        <p id="humidity">Ładowanie...</p>
    </div>
    <div>
        <h2>Ciśnienie</h2>
        <p id="pressure">Ładowanie...</p>
    </div>
    <div>
        <h2>Średnia Temperatura</h2>
        <p id="avgTemp">Ładowanie...</p>
    </div>

    <script>
        // Konfiguracja Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB0dApYE4FO5vQeTL1fPwvqoa8GVaY9kN0",
            authDomain: "stacja-pogodowa-esp32.firebaseapp.com",
            databaseURL: "https://stacja-pogodowa-esp32-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "stacja-pogodowa-esp32",
            storageBucket: "stacja-pogodowa-esp32.appspot.com",
            messagingSenderId: "your_sender_id",
            appId: "your_app_id"
        };

        // Inicjalizacja Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database(app);

        // Tablica do przechowywania wartości temperatury
        let temperatureData = [];

        // Funkcja do pobierania danych z Firebase
        function updateData() {
            // Pobieranie temperatury
            const tempRef = database.ref('/sensors/temperature_avg');
            tempRef.once('value', function(snapshot) {
                const temperature = snapshot.val(); // Odczytujemy temperaturę
                document.getElementById('temp').innerText = `Temperatura: ${temperature}°C`;

                // Dodawanie temperatury do tablicy
                temperatureData.push(temperature);

                // Jeśli mamy więcej niż 10 wartości, usuwamy najstarsze
                if (temperatureData.length > 10) {
                    temperatureData.shift();
                }

                // Obliczanie średniej temperatury
                const avgTemperature = temperatureData.reduce((acc, val) => acc + val, 0) / temperatureData.length;
                document.getElementById('avgTemp').innerText = `Średnia Temperatura: ${avgTemperature.toFixed(2)}°C`;
            });

            // Pobieranie wilgotności
            const humidityRef = database.ref('/sensors/humidity');
            humidityRef.once('value', function(snapshot) {
                const humidity = snapshot.val();
                document.getElementById('humidity').innerText = `Wilgotność: ${humidity}%`;
            });

            // Pobieranie ciśnienia
            const pressureRef = database.ref('/sensors/pressure');
            pressureRef.once('value', function(snapshot) {
                const pressure = snapshot.val();
                document.getElementById('pressure').innerText = `Ciśnienie: ${pressure} hPa`;
            });
        }

        // Aktualizowanie danych co minutę
        setInterval(updateData, 60000); // Co minutę

        // Wywołanie po raz pierwszy, aby pobrać dane
        updateData();
    </script>
</body>
</html>
